from io import StringIO

import pandas
import matplotlib.pyplot as plt

atomic = """
size,time
64,9.83612e-06
128,9.95713e-06
256,1.09168e-05
512,1.09034e-05
1024,1.22171e-05
2048,1.49625e-05
4096,2.0712e-05
8192,3.17951e-05
16384,5.43277e-05
32768,9.88598e-05
65536,0.000216711
131072,0.000364209
262144,0.000720464
524288,0.00135712
1048576,0.00282926
2097152,0.00392023
"""
thrust = """
size,time
64,1.22294e-05
128,1.16737e-05
256,1.19452e-05
512,1.17695e-05
1024,1.19975e-05
2048,1.23255e-05
4096,1.24281e-05
8192,1.45469e-05
16384,1.4948e-05
32768,1.45969e-05
65536,1.55294e-05
131072,1.47413e-05
262144,1.5324e-05
524288,0.000110262
1048576,0.000117504
2097152,0.000134126
4194304,0.000142727
8388608,0.000183896
16777216,0.000258429
33554432,0.000423238
67108864,0.000718386
134217728,0.00133029
268435456,0.00263729
536870912,0.0050194
"""
simple_sum_block = """
size,time
64,9.1974e-06
128,8.70566e-06
256,8.72709e-06
512,8.75993e-06
1024,1.69395e-05
2048,1.7039e-05
4096,1.72338e-05
8192,1.61672e-05
16384,1.68952e-05
32768,1.55548e-05
65536,1.79283e-05
131072,2.02601e-05
262144,2.2405e-05
524288,3.7903e-05
1048576,5.82371e-05
2097152,9.96284e-05
4194304,0.000173634
8388608,0.000319889
16777216,0.000616837
33554432,0.00121362
67108864,0.0024071
134217728,0.0049746
"""
shfl = """
size,time
64,1.48605e-05
128,1.50577e-05
256,1.50341e-05
512,1.47724e-05
1024,1.46227e-05
2048,1.49947e-05
4096,1.50842e-05
8192,1.50727e-05
16384,1.53939e-05
32768,1.52665e-05
65536,1.55944e-05
131072,1.5365e-05
262144,2.13197e-05
524288,2.69087e-05
1048576,3.15791e-05
2097152,4.05036e-05
4194304,6.48961e-05
8388608,0.000283407
16777216,0.000189745
33554432,0.000364742
67108864,0.000726308
134217728,0.00148366
268435456,0.00363126
536870912,0.00728794
"""
cpu = """
size,time
64,1.861e-08
128,3.935e-08
256,6.997e-08
512,1.3287e-07
1024,2.5828e-07
2048,5.0865e-07
4096,1.04624e-06
8192,2.0101e-06
16384,4.20166e-06
32768,8.0183e-06
65536,1.64325e-05
131072,3.20581e-05
262144,6.78726e-05
524288,0.000128188
1048576,0.000262533
2097152,0.000576581
4194304,0.00105913
"""


def main():
    end = 14

    def plot_item(string, label):
        df = pandas.read_csv(StringIO(string))
        plt.plot(df['size'][:end],
                 df['size'][:end] / df['time'][:end],
                 label=label)

    plot_item(atomic, "atomic")
    plot_item(simple_sum_block, "simple_sum_block")
    plot_item(thrust, "thrust")
    plot_item(cpu, "cpu")
    plot_item(shfl, "shfl")

    plt.ylabel("floats/sec")
    plt.legend()
    plt.show()


if __name__ == "__main__":
    main()
