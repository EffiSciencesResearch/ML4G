from io import StringIO

import pandas
import matplotlib.pyplot as plt

atomic_timings = """
size,time
64,9.93033e-06
128,1.00269e-05
256,1.11195e-05
512,1.10766e-05
1024,1.24312e-05
2048,1.53978e-05
4096,2.07394e-05
8192,3.20645e-05
16384,5.46006e-05
32768,0.000129448
65536,0.000189025
131072,0.000660519
262144,0.000727534
524288,0.00174334
1048576,0.00318917
2097152,0.00579743
"""

thrust = """
size,time
64,1.41782e-05
128,1.4249e-05
256,1.34192e-05
512,1.39072e-05
1024,1.40819e-05
2048,1.60705e-05
4096,1.40007e-05
8192,1.88203e-05
16384,1.8735e-05
32768,1.85124e-05
65536,1.85414e-05
131072,2.09755e-05
262144,2.22194e-05
524288,0.00012601
1048576,0.000141333
2097152,0.0001617
4194304,0.000325536
8388608,0.000192929
16777216,0.000276027
33554432,0.000430381
67108864,0.000790359
134217728,0.00137989
268435456,0.00270752
536870912,0.00520291
"""

simple_sum = """
size,time
64,9.32747e-06
128,9.38317e-06
256,1.00798e-05
512,9.66124e-06
1024,1.70473e-05
2048,1.78569e-05
4096,1.79213e-05
8192,1.71331e-05
16384,1.37501e-05
32768,1.55834e-05
65536,1.66715e-05
131072,1.99809e-05
262144,2.61341e-05
524288,4.27953e-05
1048576,6.21585e-05
2097152,0.000103938
4194304,0.000182704
8388608,0.000346078
16777216,0.00065882
33554432,0.00126647
67108864,0.00255836
134217728,0.00529327
"""

shfl = """
size,time
64,1.55815e-05
128,1.5773e-05
256,1.58107e-05
512,1.56287e-05
1024,1.47897e-05
2048,1.53152e-05
4096,1.58885e-05
8192,1.54662e-05
16384,1.6013e-05
32768,1.53755e-05
65536,1.58527e-05
131072,1.67875e-05
262144,2.31218e-05
524288,2.83692e-05
1048576,3.77154e-05
2097152,0.000244081
4194304,7.29562e-05
8388608,0.000115775
16777216,0.000202415
33554432,0.000384705
67108864,0.000760862
134217728,0.00154465
268435456,0.00373545
536870912,0.00714841
"""


def main():
    df = pandas.read_csv(StringIO(atomic_timings))
    end = 1000
    plt.plot(df['size'][:end],
             df['size'][:end] / df['time'][:end],
             label="atomic")
    df = pandas.read_csv(StringIO(simple_sum))
    plt.plot(df['size'][:end],
             df['size'][:end] / df['time'][:end],
             label="simple block")
    df = pandas.read_csv(StringIO(thrust))
    plt.plot(df['size'][:end],
             df['size'][:end] / df['time'][:end],
             label="thrust")
    df = pandas.read_csv(StringIO(shfl))
    plt.plot(df['size'][:end],
             df['size'][:end] / df['time'][:end],
             label="shfl")
    plt.ylabel("floats/sec")
    plt.legend()
    plt.show()


if __name__ == "__main__":
    main()
